<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的日记</title>
    <style>
        :root {
            --theme-color: #06019c;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
            --hover-color: #f1f5f9;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.03);
        }

        .dark-mode {
            --bg-color: #080719;
            --text-color: #e2e8f0;
            --border-color: #1e293b;
            --hover-color: #1e293b;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.15), 0 2px 4px -1px rgba(0, 0, 0, 0.10);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.20), 0 4px 6px -2px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .sidebar {
            width: 250px;
            background: var(--bg-color);
            border-right: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            background: var(--bg-color);
        }

        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        button {
            background: var(--theme-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: var(--shadow);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            opacity: 0.9;
        }

        .toolbar button:last-child {
            margin-left: auto;
        }

        select,
        input[type="color"] {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-color);
            border-radius: 6px;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .editor {
            flex: 1;
            border: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
            background: var(--bg-color);
            font-size: 16px;
            line-height: 1.8;
            border-radius: 8px;
            box-shadow: var(--shadow);
            transition: border-color 0.3s;
        }

        .editor:focus {
            border-color: var(--theme-color);
            outline: none;
        }

        .diary-list {
            list-style: none;
        }

        .diary-item {
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            box-shadow: var(--shadow);
        }

        .dark-mode .diary-item {
            background: rgba(30, 41, 59, 0.3);
        }

        .diary-item:hover {
            background: var(--hover-color);
            transform: translateX(4px);
        }

        .diary-item.active {
            background: var(--theme-color);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .delete-btn {
            background: #ef4444;
            padding: 4px 8px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .diary-item:hover .delete-btn {
            opacity: 1;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--bg-color);
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--border-color);
        }

        .color-picker {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .settings-group {
            margin-bottom: 20px;
        }

        .settings-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .indent-controls {
            display: flex;
            gap: 5px;
        }

        .indent-controls button {
            padding: 5px 10px;
            font-size: 14px;
        }

        /* 富文本样式 */
        .editor b,
        .editor strong {
            font-weight: 700;
        }

        .editor i,
        .editor em {
            font-style: italic;
        }

        .editor u {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 200px;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
        }
    </style>
  <!-- 在现有head内容下方添加 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>

<body>
    <div class="sidebar">
        <h2 style="margin-bottom: 20px;">日记列表</h2>
        <button onclick="createNewDiary()">新建日记</button>
        <ul class="diary-list" id="diaryList"></ul>
    </div>

    <div class="main-content">
        <div class="toolbar">
            <button onclick="formatText('bold')"><b>B</b></button>
            <button onclick="formatText('italic')"><i>I</i></button>
            <button onclick="formatText('underline')"><u>U</u></button>
            <input type="color" id="textColor" onchange="changeTextColor()" title="文字颜色">
            <input type="color" id="bgColor" onchange="changeBgColor()" title="背景颜色">
            <div class="indent-controls">
                <button onclick="changeIndent('increase')">增加缩进</button>
                <button onclick="changeIndent('decrease')">减少缩进</button>
            </div>
            <button onclick="clearFormatting()">清除格式</button>
            <button onclick="openSettings()">主题设置</button>
            <button onclick="toggleDarkMode()">切换主题</button>
        </div>
        
        <div class="editor" contenteditable="true" id="editor" placeholder="开始写日记..."></div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <h3>主题设置</h3>
            <div class="settings-group">
                <label>主题色：</label>
                <input type="color" id="themeColorPicker" value="#4F46E5">
            </div>
            <div class="settings-group">
                <label>背景色：</label>
                <input type="color" id="bgColorPicker" value="#f8fafc">
            </div>
            <div class="settings-group">
                <label>文字色：</label>
                <input type="color" id="textColorPicker" value="#1e293b">
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button onclick="saveSettings()">保存</button>
                <button onclick="closeSettings()">取消</button>
            </div>
        </div>
    </div>

    <script>
        let currentDiary = null;
        let settings = JSON.parse(localStorage.getItem('diarySettings')) || {
            themeColor: '#4F46E5',
            bgColor: '#f8fafc',
            textColor: '#1e293b',
            darkMode: false
        };

        // 初始化
        document.addEventListener('DOMContentLoaded', function () {
            loadSettings();
            loadDiaryList();
            createNewDiary();

            // 自动保存
            let saveTimer;
            document.getElementById('editor').addEventListener('input', function () {
                clearTimeout(saveTimer);
                saveTimer = setTimeout(autoSave, 1000);
            });
        });

        // 加载设置
        function loadSettings() {
            document.documentElement.style.setProperty('--theme-color', settings.themeColor);
            document.documentElement.style.setProperty('--bg-color', settings.bgColor);
            document.documentElement.style.setProperty('--text-color', settings.textColor);

            if (settings.darkMode) {
                document.body.classList.add('dark-mode');
            }

            document.getElementById('themeColorPicker').value = settings.themeColor;
            document.getElementById('bgColorPicker').value = settings.bgColor;
            document.getElementById('textColorPicker').value = settings.textColor;
        }

        // 创建新日记
        function createNewDiary() {
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            const timeStr = today.toTimeString().split(' ')[0].replace(/:/g, '-');
            const fileName = `diary_${dateStr}_${timeStr}.json`;

            currentDiary = {
                fileName: fileName,
                date: today.toISOString(),
                content: ''
            };

            document.getElementById('editor').innerHTML = '';
            loadDiaryList();
        }

        // 自动保存
        function autoSave() {
            if (!currentDiary) return;

            const content = document.getElementById('editor').innerHTML;
            currentDiary.content = content;

            localStorage.setItem(currentDiary.fileName, JSON.stringify(currentDiary));
            loadDiaryList();
        }

        // 加载日记列表
        function loadDiaryList() {
            const list = document.getElementById('diaryList');
            list.innerHTML = '';

            const diaries = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('diary_')) {
                    const diary = JSON.parse(localStorage.getItem(key));
                    diaries.push(diary);
                }
            }

            // 按日期排序
            diaries.sort((a, b) => new Date(b.date) - new Date(a.date));

            diaries.forEach(diary => {
                const li = document.createElement('li');
                li.className = 'diary-item';
                if (currentDiary && diary.fileName === currentDiary.fileName) {
                    li.classList.add('active');
                }

                const date = new Date(diary.date);
                const dateStr = date.toLocaleDateString('zh-CN');
                const timeStr = date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });

                li.innerHTML = `
                    <span onclick="loadDiary('${diary.fileName}')">${dateStr} ${timeStr}</span>
                    <button class="delete-btn" onclick="deleteDiary('${diary.fileName}', event)">删除</button>
                `;

                list.appendChild(li);
            });
        }

        // 加载指定日记
        function loadDiary(fileName) {
            const diary = JSON.parse(localStorage.getItem(fileName));
            if (diary) {
                currentDiary = diary;
                document.getElementById('editor').innerHTML = diary.content;
                loadDiaryList();
            }
        }

        // 删除日记
        function deleteDiary(fileName, event) {
            event.stopPropagation();
            if (confirm('确定要删除这篇日记吗？')) {
                localStorage.removeItem(fileName);
                if (currentDiary && currentDiary.fileName === fileName) {
                    createNewDiary();
                } else {
                    loadDiaryList();
                }
            }
        }

        // 格式化文本
        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('editor').focus();
        }

        // 改变文字颜色
        function changeTextColor() {
            const color = document.getElementById('textColor').value;
            document.execCommand('foreColor', false, color);
        }

        // 改变背景颜色
        function changeBgColor() {
            const color = document.getElementById('bgColor').value;
            document.execCommand('backColor', false, color);
        }

        // 改变缩进
        function changeIndent(direction) {
            if (direction === 'increase') {
                document.execCommand('indent', false, null);
            } else {
                document.execCommand('outdent', false, null);
            }
        }

        // 清除格式
        function clearFormatting() {
            document.execCommand('removeFormat', false, null);
        }

        // 打开设置
        function openSettings() {
            document.getElementById('settingsModal').style.display = 'flex';
        }

        // 关闭设置
        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        // 保存设置
        function saveSettings() {
            settings.themeColor = document.getElementById('themeColorPicker').value;
            settings.bgColor = document.getElementById('bgColorPicker').value;
            settings.textColor = document.getElementById('textColorPicker').value;

            localStorage.setItem('diarySettings', JSON.stringify(settings));
            loadSettings();
            closeSettings();
        }

        // 切换深色模式
        function toggleDarkMode() {
            settings.darkMode = !settings.darkMode;
            localStorage.setItem('diarySettings', JSON.stringify(settings));
            document.body.classList.toggle('dark-mode');
        }

        // 点击模态框外部关闭
        window.onclick = function (event) {
            const modal = document.getElementById('settingsModal');
            if (event.target === modal) {
                closeSettings();
            }
        }
    </script>
</body>

</html>